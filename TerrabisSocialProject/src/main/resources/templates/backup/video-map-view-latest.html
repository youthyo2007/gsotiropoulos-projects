<!DOCTYPE html>
<html layout:decorator="layout-map">
  <head>
    <title>Terrabis - Map</title>
         
  </head>
  <body>
  
  
  
  
        <section layout:fragment="content">
        
<!--         <div th:replace="/fragments/modal :: fullscreenoverlay-videoplay"></div> -->
        
         
         <!-- Page content-->
         <div class="content-wrapper">
         
         

         

 <div class="row">
   
   
   
   <!-- LEFT COLUMN -->



   <!-- ===================== RIGHT COLUMN ============================= -->
  <div class="col-md-12">



		<!-- ===================== FORM ============================= -->
		 <div class="row">
		  <div class="col-md-12">
		  
	
		  
                           <form id="" role="form" id="go" th:action="@{'/video/map-location/search'}" method="GET" th:object="${VIDEOQUERYFRM}">
                           
                           
                           
                           
                           <div class="row">
       
                           
     	 						<div id="title" class="col-md-12 col-xs-12 col-sm-12">
     	 							 <span class="h2 text-gray-more text-bold">WHERE DO YOU WANT TO GO?</span> 
   								</div>
   								
   								<div id="search" class="col-md-9 col-xs-12 col-sm-12">
			                           <div class="form-group">
			                               <div class="input-group">
			                                 <input id="querytxt" placeholder="Enter a location and any keyword e.g (New York # aerial drone night)" type="text" th:field="*{querytxt}" class="form-control input-lg m-b">
			                                 <span class="input-group-btn" id="go">
			                                    <button type="submit" class="btn bg-info-dark input-lg"><span class="h4 text-bold">SEARCH</span></button>
			                                 </span>
			                              </div> 
			                             </div>   								
   								</div>
   								
<!--    								<div id="paginator" class="col-md-3 col-xs-12 col-sm-12">
    									 <ul class="pagination pull-right">
										<li class="paginate_button previous disabled" aria-controls="datatable3" tabindex="0" id="datatable3_previous"><a href="#">Previous</a></li>
										<li class="paginate_button active" aria-controls="datatable3" tabindex="0"><a href="#">1</a></li>
										<li class="paginate_button " aria-controls="datatable3" tabindex="0"><a href="#">2</a></li>
										<li class="paginate_button " aria-controls="datatable3" tabindex="0"><a href="#">3</a></li>
										<li class="paginate_button " aria-controls="datatable3" tabindex="0"><a href="#">4</a></li>
										<li class="paginate_button " aria-controls="datatable3" tabindex="0"><a href="#">5</a></li>
										<li class="paginate_button " aria-controls="datatable3" tabindex="0"><a href="#">6</a></li>
										<li class="paginate_button next" aria-controls="datatable3" tabindex="0" id="datatable3_next"><a href="#">Next</a></li>   									 
   									 </ul>
   								</div> -->
   								
   								
   							</div>	
   		

   					    </form>		  
		  
		  
<!--                           <form role="form" id="go" th:action="@{'/video/query-submit'}" method="POST" th:object="${videoqueryFrm}">
                           <div class="form-group">
                               <div class="input-group">
                                 <input type="text" th:field="*{querytxt}"  class="form-control input-lg m-b" placeholder="Enter a location and any keyword e.g (New York , aerial drone night)">
                                 <span class="input-group-btn">
                                    <button type="button" class="btn btn-info input-lg"><i class="fa fa-search fa-2x"></i></button>
                                 </span>
                              </div>

                           </div>
   					     
                        </form> -->
   		</div>
   		</div>
   		
   		
   		
     	<div class="row">
              <div id="advselectedtags" class="col-md-12 col-xs-12 col-sm-12">
			</div>
		</div>
   		
   		       <div class="row">  
	              
               <div class="col-md-5 mt-sm">
		           <p class="text-sm-md text-gray text-bold text-uppercase pull-left">*click on marker to start play <!-- **right click on the map for quick upload --></p>
        		</div>
        		
	              <div class="col-md-7 col-sm-12">
			              <div class="content-control">
						                    <!--pagignator-->
						                    <ul class="breadcrumb paginator pull-right">
						                    </ul><!--paginator-->
			               </div><!-- /content-control -->
	              </div>    

        		
       </div> 		   
       
   		
       <!-- ===================== GOOGLEMAP ============================= -->
       <div class="row">
               <div class="col-md-12">
               		<div class="mapoverlay_loading hidden">
			       <div class="row">
			               <div class="col-md-12">
			               		<p class="h3 text-gray text-bold">LOADING...</p>
							</div>
					</div>
        			</div>

               		<div class="mapoverlay_not_found hidden">
			       <div class="row">
			               <div class="col-md-12">
			               		<p class="h3 text-gray text-bold"><br/></p>
							</div>
					</div>
					
                  <div class="row mb-lg m-lg">
                          <div class="col-md-12 col-xs-12 col-sm-12">
                            <span class="h2 text-bold text-gray text-left text-uppercase" th:if="${VIDEOQUERYFRM.querytxt.trim().length()>0}">OOPS!, NO PLACES OR VIDEOS MATCHED YOUR SEARCH!</span><br/><br/>
                            <span class="h2 text-bold text-gray text-left text-uppercase" th:if="${VIDEOQUERYFRM.querytxt.trim().length()==0}">YOU DIDN'T TYPE ANYTHING IN THE SEARCH BOX!</span><br/><br/>
                            
                        </div>  
                        
                        
                        
                        
                        
                          <div class="col-md-2 col-xs-12 col-sm-12">
                            <span class="fa fa-meh-o fa-12x text-bold text-white text-left"></span>
                        </div>  
                        
                          <div class="col-md-10 col-xs-12 col-sm-12"><br/><br/>
                            <span class="h2 text-white text-left"  th:if="${VIDEOQUERYFRM.querytxt.trim().length()>0}">You might try as well another search. Don't forget to use the tag cloud on the left to find related videos as well</span>
                            <span class="h2 text-white text-left"  th:if="${VIDEOQUERYFRM.querytxt.trim().length()==0}">Please enter your search terms and try again.</span>
                        </div>  
                        
                        
                        
                 </div>						
					
					
        			</div>
        			        
        			<div id="panelblock" class="panel widget w-XL h-LG mapoverlay_video_rate hidden">
         							<div class="text-center bg-center" id="subpanelblockA">
                        			<div class="row">
                           				<div class="col-xs-12 col-md-12 col-sm-12">                           				
										<div class="vidoverlay_rate_map bg-info-fade-rate">
										<div class="row row-table" th:replace="/fragments/video-grid-view ::  video-overlay-rating-map"></div>
										</div>        	
										<img class="w-XL h-LG vidoverlay_rate_map_img" src=""/> 
                          			 </div>
                        		</div>
                     		</div>
		              </div>
		
		
		
		    			
        		 	<div id="panelblock" class="panel widget w-XXXL h-XXXL mapoverlay_video_play hidden">
         							<div class="text-center bg-center" id="subpanelblockA">
                        			<div class="row">
                           				<div class="col-xs-12 col-md-12 col-sm-12">
       									<div class="vidoverlay_play_map">
	                   						<div class="row row-table" th:replace="/fragments/video-grid-view :: video-overlay-play-map(colstyle='w-XXXL h-XXXL')"></div>
	 									</div>	                           				       
                          			 </div>
                        		</div>
                     		</div>
		              </div>
        			
        			
				    <div id="panelblock" class="panel widget w-XL h-LG mapoverlay_video_preview hidden">
         							<div class="text-center bg-center" id="subpanelblockA">
                        			<div class="row">
                           				<div class="col-xs-12 col-md-12 col-sm-12">                           				
										<div class="vidoverlay_preview_map">
										<div class="row row-table" th:replace="/fragments/video-grid-view :: video-overlay-preview-map"></div>
										</div>        	
										<img class="w-XL h-LG vidoverlay_preview_map_img" src=""/> 
                          			 </div>
                        		</div>
                     		</div>
		              </div>



        
        			<div class="box-shadow-info-lg round-corner-md">
               			<div id="googlemap" class="gmaplg round-corner-md"></div>
               		</div>
           	</div>
       </div>      
       
        
        
       <!-- CONTENT CONTROL BAR AND PAGINATOR  --> 
       <div class="row mt-sm">
				              <div class="col-md-12 col-sm-12">
						              <div class="content-control">
									                    <ul class="control-nav pull-left" th:replace="/fragments/video-grid-control :: gridviewstyle-control"></ul>
									                    <!--pagignator-->
<!-- 									                    <ul class="breadcrumb paginator pull-left"></ul> -->
									                    <!--paginator-->
						               </div><!-- /content-control -->
				              </div>
       </div> 
       <!-- CONTENT CONTROL BAR  -->     
      
      	
      	
      	<!-- ===================== RESULTS ============================= -->
       <!-- AJAX -->
       <div class="row"><div class="col-md-12 col-xs-12 col-sm-12" id="videoGrid"></div></div>
        
       
        <!-- DETAIL VIEW -->
<!--         <div class="row" th:if="${PERS.item('GRIDSTYLE-'+execInfo.templateName) == 'DETAIL'}"><div class="col-md-12 col-xs-12 col-sm-12">
      		 <div th:replace="/fragments/video-grid-view :: detail(videoListDTO=${videoListDTO})"></div>
      	</div></div>	 -->
      	<!-- DETAIL VIEW -->

        <!-- BOX VIEW -->
<!--         <div class="row" th:if="${PERS.item('GRIDSTYLE-'+execInfo.templateName) == 'BOX'}"><div class="col-md-12 col-xs-12 col-sm-12">
      		 <div th:replace="/fragments/video-grid-view :: box(videoListDTO=${videoListDTO})"></div>
      	</div></div> -->	
      	<!-- BOX VIEW -->

    
    
<!--         THUMB VIEW
        <div class="row" th:if="${PERS.item('GRIDSTYLE-'+execInfo.templateName) == 'THUMB'}"><div class="col-md-12 col-xs-12 col-sm-12">
      		 <div th:replace="/fragments/video-grid-view :: thumb(videoListDTO=${videoListDTO})"></div>
      	</div></div>	 -->
      	<!-- THUMB VIEW -->    

 	<!-- ===================== RESULTS ============================= -->

            <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
            <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
   
  <!-- ===================== RIGHT COLUMN ============================= -->
 <!-- <div class="col-md-0">-</div> -->
</div>
</div>
</div> 


<script src="../static/vendor/jquery/dist/jquery.js" th:src="@{/vendor/jquery/dist/jquery.js}"></script> 
<script src="../static/vendor/jquery-bar-rating/dist/jquery.barrating.min.js" th:src="@{/vendor/jquery-bar-rating/dist/jquery.barrating.min.js}"></script> 
<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBrqn9Rl-MX3yJPDKGXL_Ly7ej6DSC0sRw&libraries=places"></script>
<script src="../static/vendor/dropzone/dropzone.js" th:src="@{/vendor/dropzone/dropzone.js}"></script> 
<script src="../static/js/video-map-view.js" th:src="@{/js/video-map-view.js}"> </script> 
<script src="../static/js/video-map-view-sidebar.js" th:src="@{/js/advanced-map-filters.js}"> </script> 
<script src="../static/js/video-grid-html-view.js" th:src="@{/js/video-grid-html-view.js}"> </script> 
<script src="../static/js/grid-view-renderer.js" th:src="@{/js/grid-view-renderer.js}"> </script> 




<script th:inline="javascript">
/*<![CDATA[*/


$( document ).ready(function() {

	

	
	
	console.log([[${GMAPRESULT.location.lat}]]+'-'+[[${GMAPRESULT.location.lng}]]);

	//INIT  TAG CLOUD
	tagwords = [[${tagDTOList}]];
	
	$('#advtagcloud').jQCloud(tagwords, {
  		shape: 'rectangular'
	});
	
	//INITIALIZE TAG VIEW
	tagfilterlist = [[${VIDEOQUERYFRM.advfilter.tagslist}]];
	var tag_html = "";
	var taginputtxt="";
	for(i=0; i<tagfilterlist.length; i++) {
			advSelectedTags.push(tagfilterlist[i]);
			taginputtxt = taginputtxt+ tagfilterlist[i]+",";
			tag =  '<button type="button" data-tagname="'+tagfilterlist[i]+'" class="tag-close btn btn-labeled btn-info-dark mr-sm">'+
					'<span class="btn-label"><i class="fa fa-times"></i>'+
					'</span>'+tagfilterlist[i]+
					'</button>';
			tag_html = tag_html+ tag;
		}
		$( "#advselectedtags" ).html(tag_html);
	
	
	
	
	
	var emptyGmapResult = [[${GMAPRESULT.emptyStatus}]];
	
	
	//PAGE SPECIFIC GRID VIEW STYLE
	terrabisApp.gridViewStyle = [[${PERS.item('GRIDSTYLE-'+{execInfo.templateName})}]];


	if(emptyGmapResult) {
		$(".mapoverlay_not_found").switchClass( "hidden", "-", 0, "easeInOutQuad" );
		$( ".mapoverlay_not_found" ).delay(5000).fadeOut(3000, "linear", function() {
			$(".mapoverlay_not_found").switchClass( "-", "hidden", 0, "easeInOutQuad" );
		  });
		
		
	}

	//if(!emptyGmapResult) {
	if(true) {

	/**********************  CREATE MAP  ********************************/	 
	terrabisApp.blockzoomevent = true;
	terrabisApp.globalMap = createMapBasedOnSearchResult([[${GMAPRESULT}]],[[${PERS.googleMapType}]]);


	/**********************  LOAD RESULTS  ********************************/	 
	 //AJAX RENDER - WHEN GOOGLE MAPS IS READY AJAX FETCH VIDEOLIST AND CREATE MARKERS
	 if(!emptyGmapResult) {
	 	google.maps.event.addListenerOnce(terrabisApp.globalMap, 'bounds_changed', map_initialize);
	 }
	
	
	//NORMAL RENDER -   VIDEOLIST AND MARKERS REPLACED BY AJAX RENDER VIDEO LIST AND MARKERS ABOVE
 	//google.maps.event.addListenerOnce(terrabisApp.globalMap, 'bounds_changed', function(){
			//createBoundsOnVisibleMarkers();
			
			//var PARTITIONS = [[${videoListDTO}]];  
			//console.log(JSON.stringify(PARTITIONS));
			//if(PARTITIONS.length>0) {
				//createVideoMarkersFromPartitions(PARTITIONS,true);
				//createHtml_GridResultView(PARTITIONS,false);
		 	//}
	//});  

	//ADD LISTENER ON BOUNDS AND QUERY BASED ON BOUNDS NEW VIDEOS
	 terrabisApp.globalMap.addListener('dragend', map_viewportChanged);
	 terrabisApp.globalMap.addListener('zoom_changed', map_zoomChanged);


	 google.maps.event.addListenerOnce(terrabisApp.globalMap, 'bounds_changed', function(){
		 var queryData = init_queryCriteriaData();
		 highlightCriteriaMenu(queryData);	

		 
		 		 /**********************  RIIGHT CLICK ON MAP ********************************/
		if(([[${(#authorization.expression('isAuthenticated()'))}]])) { 
			    //google.maps.event.addListener(terrabisApp.globalMap, 'rightclick', createUploadMarkerOnMapRightClick);
		};
		//END QUICK UPLOAD LISTENER
		 
		 
	 });
	 
	 
	 
	 
	 //ADD MAPTYPE CHANGED LISTENER AND SAVED IT TO PERSONALIZAITON OBJECT
	 google.maps.event.addListener(terrabisApp.globalMap, "maptypeid_changed", function() {
	 	var callback = function(data, status, xhr) {
		};

		var newMapType = terrabisApp.globalMap.getMapTypeId();
		var formData = { googleMapType: newMapType};
		restajax(terrabisApp.PERSGoogleMapTypeURI,formData,callback);	
	});
	 
	 
	 } //END IF EMPTY STATUS
	 
	/**********************  MODAL UPLOAD MODAL ********************************/	 
	$('#uploadModal').on('shown.bs.modal', function (e) {
	    setTimeout(function(){
	    	$('#videofileuploadform').find('input[name="title"]').val("");
	    	$('#videofileuploadform').find('textarea[name="description"]').val("");
	    	$('#videofileuploadform').find('input[name="latitude"]').val(uploadMarker.position.lat());
			$('#videofileuploadform').find('input[name="longitude"]').val(uploadMarker.position.lng());
	    }, 300);                        
	});
	

	/**********************  AUTOCOMPLETE  ********************************/
	var input =  document.getElementById('querytxt');
	var autocomplete = new google.maps.places.Autocomplete(input);
  
 
	
	
	 

	/**********************  GRIDVIEWSTYLE BOX, THUMB, DETAIL CLICK ICON  ********************************/	 
/* 	$(".gridviewstyle-control").click(function() {
		//initializeGridViewControls(this.id);
		//terrabisApp.gridViewStyle = this.id;
		//createHtml_GridResultView(terrabisApp.data,true);
		
		//UPDATE SESSION WITH THE NEW STYLE
		//gridview_StyleChange(this.id);
		
	}); */

	 
	 
	 
	 
	 
	 
	

}); 	
		
	
/*]]>*/
</script>   


<script th:inline="javascript">
/*<![CDATA[*/
           
/****************** FORM VALIDATION **************************************************************/
$( document ).ready(function() {



var regYoutube = "/^.*((youtu.be/)|(v/)|(/u/w/)|(embed/)|(watch?))??v?=?([^#&?]*).*/";
var regVimeo = "/^.*(vimeo.com/)((channels/[A-z]+/)|(groups/[A-z]+/videos/))?([0-9]+)/";


var formValidation = $('#videofileuploadform').formValidation({
    framework: 'bootstrap',
    icon: {
        valid: 'fa  fa-check',
        invalid: 'fa fa-check fa-remove',
        validating: 'fa fa-refresh'
    },
    fields: {
        title: {
            validators: {
                notEmpty: {
                    message: 'Video title is required'
                }
            }
        },
        "footagedate": {
            validators: {
                notEmpty: {
                    message: 'Footage date is required'
                },
	            date: {
	                format: 'DD/MM/YYYY',
	                message: 'The value is not a valid date'
	            }
	        }
	                
        },
        "privacy": {
            validators: {
                notEmpty: {
                    message: 'Video privacy is required'
                }
            }
        },
        "linkedurl": {
            validators: {
                notEmpty: {
                    message: 'Video URL is required'
                },
	            regexp: {
	                regexp: /((http(s)?:\/\/)?)(www\.)?((vimeo\.com\/)|(youtube\.com\/)|(youtu.be\/))[\S]+/,
	                message: 'This is not a valid YouTube or Vimeo URL'
	            }, 	            
                remote: {
	                        message: 'This video is already uploaded by another user',
	                        data: function(validator, $field, value) {
	                            return {
	                            	videourl: validator.getFieldElements('linkedurl').val()
	                            };
	                        },
	                        url: '/rest-validation/upload/duplicate/video-url',
	                        type:  [[${_csrf.token}]]
	                }
		
            }
        },
        "description": {
            validators: {
                notEmpty: {
                    message: 'Enter a short description'
                }
            }
        },
        "category.id": {
            validators: {
                notEmpty: {
                    message: 'Category is required'
                }
            }
        }
    }
	});	



});	


/*]]>*/
</script>  



<!-- <script th:src="@{/js/video-upload-index.js}" src="../static/js/video-upload-index.js"></script> -->



</section>
      
 
      
  </body>
</html>  
	  
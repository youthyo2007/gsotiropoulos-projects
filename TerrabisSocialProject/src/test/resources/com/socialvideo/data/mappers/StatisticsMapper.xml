<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  


<mapper namespace="com.socialvideo.data.mappers.StatisticsMapper">


   <resultMap type="com.socialvideo.data.dto.statistics.StatisticsDayActivityDTO" id="StatisticsDayActivityDTO">
	        <result property="videocount" column="videocount"/>   
	        <result property="usercount" column="usercount"/>   
	        <result property="sharecount" column="sharecount"/>   
	        <result property="ratingcount" column="ratingcount"/>   
	        <result property="reviewcount" column="reviewcount"/>   
	        <result property="likecount" column="likecount"/>   
	        <result property="playcount" column="playcount"/> 
	        <result property="activitydate" column="activitydate"/> 
	        <result property="datestring" column="datestring"/> 
    </resultMap> 
  

  
  
   <resultMap type="com.socialvideo.data.dto.statistics.StatisticsVideoStatusDTO" id="StatisticsVideoStatusDTO">
           <result property="total"  column="total"/>
           <result property="status_YOUTUBETOOLUPLOADED"  column="YOUTUBETOOLUPLOADED"/>
           <result property="status_JUSTUPLOADED"  column="JUSTUPLOADED"/>
           <result property="status_EXCELUPLOADED"  column="EXCELUPLOADED"/>
           <result property="status_PUBLISHED"  column="PUBLISHED"/>
           <result property="status_APPROVED"  column="APPROVED"/>
           <result property="status_STAGING" column="STAGING"/>
           <result property="status_UNPUBLISHED" column="UNPUBLISHED"/>
           <result property="status_REJECTED" column="REJECTED"/>
           <result property="promote_status_MAP" column="PROMOTEMAP"/>
           <result property="promote_status_SITEINDEX" column="PROMOTESITEINDEX"/>
           <result property="health_BROKEN" column="BROKEN"/>
           <result property="mark_UNWANTED" column="MARKASUNWANTED"/>
           
           
           
    </resultMap> 


   <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerTimeDTO" id="BIChartCountsPerMonthTimeDTO">
        <result property="month" column="monthno"/> 
        <result property="monthString" column="monthstring"/> 
        <result property="year" column="yearno"/> 
        <result property="count" column="counts"/>   
    </resultMap>  

    
   
  <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerColumnDTO" id="BIChartCountsPerColumnDTO">
        <result property="columnDesc" column="columnDesc"/> 
        <result property="count" column="counts"/>   
    </resultMap>  
       
    <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerTimeDTO" id="BIChartCountsPerDayTimeDTO">
        <result property="day" column="dayno"/> 
        <result property="month" column="monthno"/> 
        <result property="monthString" column="monthstring"/> 
        <result property="dayString" column="daystring"/> 
        <result property="dateString" column="datestring"/> 
        <result property="dateNumber" column="datenumber"/> 
        <result property="dateCreated" column="datecreated"/> 
    </resultMap>  

    <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerTimeDTO"  extends="BIChartCountsPerDayTimeDTO" id="BIChartSingleLineCountsPerDayTimeDTO">
        <result property="counttype" column="counttype"/> 
        <result property="count" column="counts"/>   
    </resultMap>  


    <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerTimeDTO" extends="BIChartCountsPerDayTimeDTO" id="BIChartVideosVsUsersCountsPerDayTimeDTO">
        <result property="videocount" column="videocount"/>   
        <result property="usercount" column="usercount"/>   
    </resultMap>  


    <resultMap type="com.socialvideo.data.dto.statistics.BIChartCountsPerTimeDTO" extends="BIChartCountsPerDayTimeDTO" id="BIChartAllCountsPerDayTimeDTO">
        <result property="videocount" column="videocount"/>   
        <result property="usercount" column="usercount"/>   
        <result property="sharecount" column="sharecount"/>   
        <result property="ratingcount" column="ratingcount"/>   
        <result property="reviewcount" column="reviewcount"/>   
        <result property="likecount" column="likecount"/>   
        <result property="playcount" column="playcount"/>   
    </resultMap>  


	

	<select id="selectStatisticsDayActivityLastDate" resultType="java.util.Date">
		select max(a.activitydate) from statisticsactivityday a
	</select>
	
	
	
	  <select id="selectCountStatisticsDayActivityList" parameterType="map"  resultType="java.lang.Integer">
		SELECT COUNT(*) AS TOTAL from statisticsactivityday a where 1 = 1 
		   <if test="QUERY.dateCreatedFromString != null and QUERY.dateCreatedFromString != ''.toString()">
           <![CDATA[ and a.datecreated >= #{QUERY.dateCreatedFromString} ]]>
           </if>
           
          <if test="QUERY.dateCreatedToString != null and QUERY.dateCreatedToString != ''.toString()">
           <![CDATA[ and a.datecreated <= #{QUERY.dateCreatedToString} ]]>
           </if>  
	</select>
	
	
	
   <select id="selectStatisticsDayActivityList" parameterType="map" resultMap="StatisticsDayActivityDTO">
		SELECT DATE_FORMAT(a.activitydate,'%d/%c/%Y') as datestring, a.* from statisticsactivityday a where 1 = 1 
		   <if test="QUERY.dateCreatedFromString != null and QUERY.dateCreatedFromString != ''.toString()">
           <![CDATA[ and a.datecreated >= #{QUERY.dateCreatedFromString} ]]>
           </if>
           
          <if test="QUERY.dateCreatedToString != null and QUERY.dateCreatedToString != ''.toString()">
           <![CDATA[ and a.datecreated <= #{QUERY.dateCreatedToString} ]]>
           </if>  
		
		order by a.activitydate desc LIMIT #{offset}, #{limit}; 
	</select>




    <select id="selectUserVideoAllStatus" parameterType="map" resultMap="StatisticsVideoStatusDTO">
       SELECT  count(*) AS total, 
       count(case when status = -1 then 1 end) JUSTUPLOADED, 
       count(case when status = 1 then 1 end) PUBLISHED, 
       count(case when status = 2 then 2 end) APPROVED, 
       count(case when status = 3 then 3 end) STAGING, 
       count(case when status = 4 then 4 end) UNPUBLISHED, 
       count(case when status = 5 then 5 end) REJECTED,
       count(case when promotemap=1 then 6 end) PROMOTEMAP,
       count(case when promotesiteindex=1 then 7 end) PROMOTESITEINDEX, 
       count(case when W.healthstatus=2 then 8 end) BROKEN,
       count(case when W.status=6 then 9 end) YOUTUBETOOLUPLOADED,
       count(case when W.status=7 then 10 end) EXCELUPLOADED   
       FROM 
       (select a.status, a.healthstatus, a.promotemap, a.promotesiteindex  FROM videos a,  users b WHERE 1 = 1 AND a.userid_fk = #{userid} GROUP BY a.id) AS W     
    </select>

    <select id="selectAdminVideoAllStatus" parameterType="map" resultMap="StatisticsVideoStatusDTO">
 
       SELECT  count(*) AS total,
       count(case when W.status = -1 then 1 end) JUSTUPLOADED, 
       count(case when W.status = 1 then 1 end) PUBLISHED, 
       count(case when W.status = 2 then 2 end) APPROVED, 
       count(case when W.status = 3 then 3 end) STAGING, 
       count(case when W.status = 4 then 4 end) UNPUBLISHED, 
       count(case when W.status = 5 then 5 end) REJECTED,
   	   count(case when W.promotemap=1 then 6 end) PROMOTEMAP,
       count(case when W.promotesiteindex=1 then 7 end) PROMOTESITEINDEX,
       count(case when W.healthstatus=2 then 8 end) BROKEN,
       count(case when W.status=6 then 9 end) YOUTUBETOOLUPLOADED,
       count(case when W.status=7 then 10 end) EXCELUPLOADED,
       count(case when W.markasunwanted=1 then 11 end) MARKASUNWANTED
       
       
       
       FROM 
       (select a.status, a.healthstatus, a.promotemap, a.promotesiteindex, a.markasunwanted FROM videos a,  users b WHERE 1 = 1 
		<if test="QUERY.advfilter.username != null and QUERY.advfilter.username != ''.toString()">
       		AND a.userid_fk = b.id AND b.username LIKE #{QUERY.advfilter.username} 
     	</if>
     	
     	<if test="QUERY.advfilter.ytvmusername != null and QUERY.advfilter.ytvmusername != ''.toString()">
       		AND a.ytvmusername LIKE #{QUERY.advfilter.ytvmusername} 
     	</if>
     	
     	 <if test="QUERY.advfilter.markasunwanted">
       		AND a.markasunwanted = 1
     	</if>
     	
     	
     	<if test="QUERY.advfilter.videotitle != null and QUERY.advfilter.videotitle != ''.toString()">
       		AND a.title LIKE #{QUERY.advfilter.videotitle} 
     	</if>
     	
     	<if test="QUERY.advfilter.videoid != null and QUERY.advfilter.videoid != ''.toString()">
       		AND a.id =  #{QUERY.advfilter.videoid} 
     	</if>
     	
     	
     	
       GROUP BY a.id) AS W 
    	
    </select>





    <select id="selectBIVideoAllStatus" parameterType="map" resultMap="StatisticsVideoStatusDTO">
 
       SELECT  count(*) AS total,
       count(case when W.status = -1 then 1 end) JUSTUPLOADED, 
       count(case when W.status = 1 then 1 end) PUBLISHED, 
       count(case when W.status = 2 then 2 end) APPROVED, 
       count(case when W.status = 3 then 3 end) STAGING, 
       count(case when W.status = 4 then 4 end) UNPUBLISHED, 
       count(case when W.status = 5 then 5 end) REJECTED 
       FROM 
       (select a.status FROM videos a WHERE 1 = 1 
		   <if test="QUERY.dateCreatedFromString != null and QUERY.dateCreatedFromString != ''.toString()">
           <![CDATA[ and a.datecreated >= #{QUERY.dateCreatedFromString} ]]>
           </if>
           
          <if test="QUERY.dateCreatedToString != null and QUERY.dateCreatedToString != ''.toString()">
           <![CDATA[ and a.datecreated <= #{QUERY.dateCreatedToString} ]]>
           </if>  
       GROUP BY a.id) AS W    	
    </select>





</mapper>




